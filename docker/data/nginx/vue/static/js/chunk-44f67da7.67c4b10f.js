(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44f67da7"],{"0c27":function(t,e,i){},"3e7f":function(t,e,i){"use strict";i("0c27")},6827:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return r})),i.d(e,"f",(function(){return c})),i.d(e,"e",(function(){return l}));var n=i("b775");function s(t,e,i){return Object(n["a"])({url:"/sip/record/devquery/"+t+"/"+e,method:"get",params:i})}function a(t){return Object(n["a"])({url:"/sip/record/serverRecord/list",method:"get",params:t})}function o(t){return Object(n["a"])({url:"/sip/record/serverRecord/date/list",method:"get",params:t})}function r(t){return Object(n["a"])({url:"/sip/record/serverRecord/file/list",method:"get",params:t})}function c(t,e){return Object(n["a"])({url:"/sip/record/play/"+t+"/"+e,method:"get"})}function l(t,e,i){return Object(n["a"])({url:"/sip/record/download/"+t+"/"+e,method:"get",params:i})}},"6a9b":function(t,e,i){"use strict";i("a95f")},a95f:function(t,e,i){},af6c:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoging,expression:"isLoging"}],attrs:{id:"devicePlayer"}},[i("div",{staticClass:"player-wrapper"},[i("div",{staticClass:"container-shell"},[i("div",{ref:"container",attrs:{id:"container"}})]),i("div",{staticClass:"player-display"})]),i("el-tabs",{staticStyle:{"padding-bottom":"15px"},on:{"tab-click":t.tabHandleClick},model:{value:t.tabActiveName,callback:function(e){t.tabActiveName=e},expression:"tabActiveName"}},[i("el-tab-pane",{attrs:{label:"设备直播",name:"media"}},[i("el-col",{attrs:{span:24}},[i("div",{staticStyle:{display:"flex","justify-content":"left"}},[i("div",{staticClass:"control-wrapper"},[i("div",{staticClass:"control-btn control-top",on:{mousedown:function(e){return t.ptzDirection(0,1)},mouseup:function(e){return t.ptzDirection(0,0)}}},[i("i",{staticClass:"el-icon-caret-top"}),i("div",{staticClass:"control-inner-btn control-inner"})]),i("div",{staticClass:"control-btn control-left",on:{mousedown:function(e){return t.ptzDirection(2,0)},mouseup:function(e){return t.ptzDirection(0,0)}}},[i("i",{staticClass:"el-icon-caret-left"}),i("div",{staticClass:"control-inner-btn control-inner"})]),i("div",{staticClass:"control-btn control-bottom",on:{mousedown:function(e){return t.ptzDirection(0,2)},mouseup:function(e){return t.ptzDirection(0,0)}}},[i("i",{staticClass:"el-icon-caret-bottom"}),i("div",{staticClass:"control-inner-btn control-inner"})]),i("div",{staticClass:"control-btn control-right",on:{mousedown:function(e){return t.ptzDirection(1,0)},mouseup:function(e){return t.ptzDirection(0,0)}}},[i("i",{staticClass:"el-icon-caret-right"}),i("div",{staticClass:"control-inner-btn control-inner"})]),i("div",{staticClass:"control-round"},[i("div",{staticClass:"control-round-inner"},[i("i",{staticClass:"fa fa-pause-circle"})])]),i("div",{staticStyle:{position:"absolute",left:"8.25rem",top:"1.1rem",cursor:"pointer",display:"flex",width:"100px"},on:{mousedown:function(e){return t.ptzScale(1)},mouseup:function(e){return t.ptzScale(0)}}},[i("svg-icon",{staticStyle:{"font-size":"30px"},attrs:{"icon-class":"big"}}),i("span",{staticStyle:{"line-height":"30px",color:"#999","margin-left":"6px"}},[t._v("放大")])],1),i("div",{staticStyle:{position:"absolute",left:"8.25rem",top:"3.3rem",cursor:"pointer",display:"flex",width:"100px"},on:{mousedown:function(e){return t.ptzScale(2)},mouseup:function(e){return t.ptzScale(0)}}},[i("svg-icon",{staticStyle:{"font-size":"30px"},attrs:{"icon-class":"small"}}),i("span",{staticStyle:{"line-height":"30px",color:"#999","margin-left":"6px"}},[t._v("缩小")])],1),i("div",{staticClass:"contro-speed",staticStyle:{position:"absolute",left:"4px",top:"7rem",width:"9rem"}},[i("el-slider",{attrs:{max:255},model:{value:t.controSpeed,callback:function(e){t.controSpeed=e},expression:"controSpeed"}})],1)])])])],1),i("el-tab-pane",{attrs:{label:"录像回放",name:"record"}},[i("div",{staticClass:"components-container"},[t.videoVod?i("div",[i("el-row",{staticStyle:{"margin-bottom":"34px"}},[i("span",{staticStyle:{overflow:"auto"}},[t._v("选择录像日期：")]),i("el-date-picker",{attrs:{type:"date",size:"small",clearable:"",placeholder:"选择日期"},on:{change:t.loadDevRecord},model:{value:t.queryDate,callback:function(e){t.queryDate=e},expression:"queryDate"}})],1)],1):t._e(),i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.playerLoading,expression:"playerLoading"}]},[i("el-col",{attrs:{span:24}},[i("el-row",{staticClass:"ctrl ctrl-btn",attrs:{type:"flex",align:"middle"}},[i("el-col",{staticStyle:{overflow:"auto",display:"flex"},attrs:{span:24,xs:24,sm:24}},[t.playing?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-video-play",size:"mini"},on:{click:t.preparePlay}},[t._v("播放 ")]),t.playing?i("el-button",{attrs:{type:"danger",icon:"el-icon-video-pause",size:"mini"},on:{click:t.stopPlay}},[t._v(" 停止 ")]):t._e(),t.pausing?i("el-button",{attrs:{type:"primary",icon:"el-icon-video-play",size:"mini",disabled:!t.playing},on:{click:t.resume}},[t._v("恢复 ")]):t._e(),t.pausing?t._e():i("el-button",{attrs:{type:"danger",icon:"el-icon-video-pause",size:"mini",disabled:!t.playing},on:{click:t.pause}},[t._v("暂停 ")]),i("el-slider",{staticClass:"hidden-xs-only",staticStyle:{width:"100px",margin:"0 30px 0 30px"},attrs:{disabled:t.quieting,"format-tooltip":t.formatVolumeToolTip},on:{change:t.changeVolume},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}}),i("el-button",{staticClass:"hidden-xs-only",attrs:{icon:"el-icon-full-screen",size:"mini"},on:{click:t.fullscreen}},[t._v("全屏 ")]),i("el-button",{attrs:{icon:"el-icon-camera-solid",size:"mini"},on:{click:t.screenShot}},[t._v("截图")])],1)],1)],1)],1)],1)])],1)],1)},s=[],a=(i("a9e3"),i("e9c4"),i("d3b7"),i("e2de")),o=i("f5a7"),r=i("6827"),c={name:"DevicePlayerTemp",props:{},jessibuca:null,data:function(){return{tabActiveName:"media",isLoging:!1,showVideoDialog:!1,playerLoading:!1,deviceId:"",channelId:"",streamId:"",url:{ssrc:"",playurl:""},playing:!1,quieting:!0,pausing:!1,paused:!1,volume:100,hasaudio:!1,controSpeed:30,retryCount:0,videoVod:!1,queryDate:"",vodIndex:0,vodData:{},hisData:[]}},beforeDestroy:function(){this.cleanPlayer(!0)},created:function(){var t=this;this.$route.params&&(this.tabActiveName=this.$route.params.tab,this.channelId=this.$route.params.channelId,this.deviceId=this.$route.params.deviceId,this.streamId=this.$route.params.streamInfo.streamId,this.url.playurl=this.$route.params.streamInfo.playurl,this.hasaudio=this.$route.params.hasAudio),this.showVideoDialog=!0,this.$nextTick((function(){t.preparePlay()}))},methods:{create:function(){var t=new window.JessibucaPro({container:this.$refs.container,videoBuffer:Number(.2),decoder:"/js/jessibuca-pro/decoder-pro.js",timeout:20,debug:!0,isResize:!1,useWCS:!1,useMSE:!1,useSIMD:!0,wcsUseVideoRender:!1,loadingText:"加载中...",isFlv:!0,showBandwidth:!0,supportDblclickFullscreen:!0,operateBtns:{fullscreen:!1,play:!1,ptz:!1,zoom:!1},forceNoOffscreen:!0,playbackForwardMaxRateDecodeIFrame:4,playbackCurrentTimeMove:!1,networkDelayTimeoutReplay:!0});this.$options.jessibuca=t;var e=this;t.on("error",(function(t){console.log("error"),console.log(t),e.destroy()})),t.on("pause",(function(t){console.log("pause success!"),console.log(t)})),t.on("stats",(function(t){console.log("stats is",t)})),t.on("timeout",(function(){console.log("timeout"),e.cleanPlayer(!0),e.retryCount<=5&&("media"===e.tabActiveName&&e.sendDevicePush(),e.retryCount++)}));var i=0,n=0;t.on("timeUpdate",(function(t){n=parseInt(t/6e4),i!==n&&i++})),this.videoVod&&(console.log("create videoVod"),t.on("playbackSeek",(function(t){e.seekPlay(t)})))},initUrl:function(t){t?(this.streamId=t.ssrc,this.url.ssrc=t.ssrc,this.url.playurl=t.playurl):(this.streamId="",this.url.ssrc="",this.url.playurl="")},cleanPlayer:function(t){this.destroy(),t&&this.stopPlay(),this.playing=!1},destroy:function(){this.$options.jessibuca&&this.$options.jessibuca.destroy(),this.showVideoDialog&&this.create()},tabHandleClick:function(t,e){switch(this.cleanPlayer(!0),this.tabActiveName){case"media":this.videoVod=!1,this.sendDevicePush();break;case"record":this.videoVod=!0;break}},openDialog:function(t,e,i,n){var s=this;this.tabActiveName=t,this.channelId=i,this.deviceId=e,this.streamInfo=n.streamInfo,this.streamId=n.streamInfo.streamId,this.url.playurl=n.streamInfo.playurl,this.hasaudio=n.hasAudio,this.showVideoDialog=!0,this.$nextTick((function(){s.preparePlay()}))},close:function(){var t=this;this.$options.jessibuca&&(console.log("jessibuca播放器销毁"),this.$options.jessibuca.destroy()),this.streamId&&this.playing&&Object(a["b"])(this.deviceId,this.streamId).then((function(e){console.log("停止推流 streamId："+t.streamId)})),this.videoUrl="",this.queryDate="",this.streamId="",this.deviceId="",this.channelId="",this.videoVod=!1,this.showVideoDialog=!1,this.url={ssrc:"",playurl:""}},preparePlay:function(){switch(this.cleanPlayer(!1),this.tabActiveName){case"media":this.play(this.hasAudio);break;case"record":this.loadDevRecord();break}},sendDevicePush:function(){var t=this;console.log("通知设备推流1："+this.deviceId+" : "+this.channelId),Object(a["k"])(this.deviceId,this.channelId).then((function(e){console.log("开始播放："+t.deviceId+" : "+t.channelId),console.log("流媒体信息："+e.data);var i=e.data;console.log("playurl："+i.playurl),t.streamId=i.streamId,t.url.playurl=i.playurl,t.play(t.hasaudio)}))},play:function(t){this.hasaudio=t,this.isLoging=!1,this.playing=!0,this.$options.jessibuca.play(this.url.playurl)},ptzDirection:function(t,e){console.log("云台方向控制："+t+" : "+e);var i={leftRight:t,upDown:e,moveSpeed:125};Object(o["c"])(this.deviceId,this.channelId,i).then((function(t){console.log("云台方向控制："+JSON.stringify(t))}))},ptzScale:function(t){console.log("云台缩放："+t);var e={inOut:t,scaleSpeed:30};Object(o["d"])(this.deviceId,this.channelId,e).then((function(t){console.log("云台方向控制："+JSON.stringify(t))}))},loadDevRecord:function(){var t=this;if(this.cleanPlayer(!1),this.deviceId&&this.channelId){var e=this.queryDate?new Date(this.queryDate).getTime():new Date((new Date).toLocaleDateString()).getTime(),i=e/1e3,n=Math.floor((e+864e5-1)/1e3),s={start:i,end:n};this.vodData={start:i,end:n,base:i},Object(r["a"])(this.deviceId,this.channelId,s).then((function(e){if(t.hisData=e.data.recordItems,e.data.recordItems){var s=t.hisData.length;s>0?(t.hisData[0].start<i?(t.hisData[0].start=i,t.vodData.start=i):t.vodData.start=t.hisData[0].start,t.hisData[0].end<n&&(t.vodData.end=t.hisData[0].end),t.playbackstart()):t.$message({type:"warning",message:"请确认设备是否支持录像，或者设备SD卡是否正确插入！"})}else t.$message({type:"warning",message:"请确认设备是否支持录像，或者设备SD卡是否正确插入！"})})).catch((function(){t.playerLoading=!1}))}},triggerPlay:function(t){var e=this;this.playing?(clearTimeout(this.timer),this.$options.jessibuca.on("play",(function(){e.quieting=e.$options.jessibuca.quieting})),this.videoVod&&(this.$options.jessibuca.playback(this.url.playurl,{playList:t,fps:20}),this.timer=setTimeout((function(){e.playerLoading=!1}),2e3))):this.playerLoading=!1},playbackstart:function(){var t=this;if(this.deviceId&&this.channelId)if(this.playerLoading=!0,this.pausing=!1,this.url.ssrc)playbackStop(this.deviceId,this.channelId,this.url.ssrc).then((function(e){var i={start:t.vodData.start,end:t.vodData.end};Object(a["f"])(t.deviceId,t.channelId,i).then((function(e){t.playing=!0,console.log(e.data),t.initUrl(e.data)})).finally((function(){t.triggerPlay(t.hisData)}))})).catch((function(){t.playerLoading=!1}));else{var e={start:this.vodData.start,end:this.vodData.end};Object(a["f"])(this.deviceId,this.channelId,e).then((function(e){console.log(e),t.playing=!0,t.initUrl(e.data)})).finally((function(){t.triggerPlay(t.hisData)}))}},stopPlay:function(){var t=this;this.streamId&&this.playing&&(this.playerLoading=!0,this.pausing=!1,Object(a["b"])(this.deviceId,this.streamId).then((function(e){t.playing=!1,t.$options.jessibuca&&(t.retryCount=0,t.destroy()),t.streamId="",t.url={ssrc:"",playurl:""}})).finally((function(){t.playerLoading=!1})))},mute:function(){this.playing&&(this.$options.jessibuca.mute(),this.quieting=!0)},cancelMute:function(){this.playing&&(this.$options.jessibuca.cancelMute(),this.quieting=!1)},formatVolumeToolTip:function(t){return"音量条: "+t},changeVolume:function(){this.$options.jessibuca.setVolume(this.volume/100)},screenShot:function(){this.playing&&this.$options.jessibuca.screenshot()},fullscreen:function(){this.playing&&(this.fullscreening=!this.fullscreening,this.$options.jessibuca.setFullscreen(this.fullscreening))},scalePlay:function(){var t=this;this.url.ssrc&&this.playing&&Object(a["j"])(this.deviceId,this.channelId,this.streamId,this.speed).then((function(e){t.$options.jessibuca.scale(t.speed)}))},seekPlay:function(t){var e=this,i=this.vodData.base+3600*t.hour+60*t.min+t.second,n=i-this.vodData.start;if(this.url.ssrc&&this.playing){var s={seek:n};Object(a["i"])(this.deviceId,this.channelId,this.streamId,s).then((function(t){e.$options.jessibuca.setPlaybackStartTime(i)}))}},pause:function(){var t=this;this.url.ssrc&&this.playing&&(this.videoVod?Object(a["g"])(this.deviceId,this.channelId,this.streamId).then((function(e){console.log(e),200===e.code&&(t.pausing=!0,t.$options.jessibuca.pause())})):(this.$options.jessibuca.pause(),this.pausing=!0))},resume:function(){var t=this;this.url.ssrc&&(this.pausing?Object(a["h"])(this.deviceId,this.channelId,this.streamId).then((function(e){console.log(e),200===e.code&&(t.pausing=!1,t.loadDevRecord())})):(this.$options.jessibuca.play(),this.pausing=!1))},isPause:function(t){this.paused=t},changeSpeed:function(t){this.speed!==t&&(this.speed=t,this.scalePlay())}}},l=c,u=(i("6a9b"),i("3e7f"),i("2877")),d=Object(u["a"])(l,n,s,!1,null,null,null);e["default"]=d.exports},e2de:function(t,e,i){"use strict";i.d(e,"e",(function(){return s})),i.d(e,"d",(function(){return a})),i.d(e,"a",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"k",(function(){return c})),i.d(e,"f",(function(){return l})),i.d(e,"b",(function(){return u})),i.d(e,"g",(function(){return d})),i.d(e,"h",(function(){return h})),i.d(e,"i",(function(){return p})),i.d(e,"j",(function(){return f}));var n=i("b775");function s(t){return Object(n["a"])({url:"/sip/channel/list",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/sip/channel/"+t,method:"get"})}function o(t,e){return Object(n["a"])({url:"/sip/channel/"+t,method:"post",data:e})}function r(t){return Object(n["a"])({url:"/sip/channel/"+t,method:"delete"})}function c(t,e){return Object(n["a"])({url:"/sip/player/play/"+t+"/"+e,method:"get"})}function l(t,e,i){return Object(n["a"])({url:"/sip/player/playback/"+t+"/"+e,method:"get",params:i})}function u(t,e){return Object(n["a"])({url:"/sip/player/closeStream/"+t+"/"+e,method:"get"})}function d(t,e,i){return Object(n["a"])({url:"/sip/player/playbackPause/"+t+"/"+e+"/"+i,method:"get"})}function h(t,e,i){return Object(n["a"])({url:"/sip/player/playbackReplay/"+t+"/"+e+"/"+i,method:"get"})}function p(t,e,i,s){return Object(n["a"])({url:"/sip/player/playbackSeek/"+t+"/"+e+"/"+i,method:"get",params:s})}function f(t,e,i,s){return Object(n["a"])({url:"/sip/player/playbackSpeed/"+t+"/"+e+"/"+i,method:"get",params:s})}},f5a7:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return r}));var n=i("b775");function s(t){return Object(n["a"])({url:"/sip/device/listchannel/"+t,method:"get"})}function a(t){return Object(n["a"])({url:"/sip/device/sipid/"+t,method:"delete"})}function o(t,e,i){return Object(n["a"])({url:"/sip/ptz/direction/"+t+"/"+e,method:"post",data:i})}function r(t,e,i){return Object(n["a"])({url:"/sip/ptz/scale/"+t+"/"+e,method:"post",data:i})}}}]);
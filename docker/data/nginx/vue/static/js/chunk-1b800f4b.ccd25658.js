(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b800f4b","chunk-245772a2"],{"5a6f":function(e,r,t){"use strict";t.d(r,"e",(function(){return a})),t.d(r,"d",(function(){return i})),t.d(r,"a",(function(){return l})),t.d(r,"f",(function(){return n})),t.d(r,"c",(function(){return s})),t.d(r,"b",(function(){return m}));var o=t("b775");function a(e){return Object(o["a"])({url:"/sip/mediaserver/list",method:"get",params:e})}function i(){return Object(o["a"])({url:"/sip/mediaserver/",method:"get"})}function l(e){return Object(o["a"])({url:"/sip/mediaserver",method:"post",data:e})}function n(e){return Object(o["a"])({url:"/sip/mediaserver",method:"put",data:e})}function s(e){return Object(o["a"])({url:"/sip/mediaserver/"+e,method:"delete"})}function m(e){return Object(o["a"])({url:"/sip/mediaserver/check",method:"get",params:e})}},7837:function(e,r,t){"use strict";t.r(r);var o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoging,expression:"isLoging"}],attrs:{id:"mediaServerEdit"}},[t("el-dialog",{attrs:{title:"流媒体服务器节点",width:e.dialogWidth,top:"2rem","close-on-click-modal":!1,visible:e.showDialog,"destroy-on-close":!0},on:{"update:visible":function(r){e.showDialog=r},close:function(r){return e.close()}}},[t("div",{staticStyle:{"margin-top":"1rem","margin-right":"20px"},attrs:{id:"formStep"}},[1==e.currentStep?t("el-form",{ref:"mediaServerForm",staticStyle:{width:"70%"},attrs:{rules:e.rules,model:e.mediaServerForm,"label-width":"280px"}},[t("el-form-item",{attrs:{label:"所属租户",prop:"productName"}},[t("el-input",{attrs:{readonly:"",placeholder:"请选择所属租户"},model:{value:e.mediaServerForm.tenantName,callback:function(r){e.$set(e.mediaServerForm,"tenantName",r)},expression:"mediaServerForm.tenantName"}},[t("el-button",{attrs:{slot:"append"},on:{click:function(r){return e.selectUser()}},slot:"append"},[e._v("选择")])],1)],1),t("el-form-item",{attrs:{label:"服务器IP",prop:"ip"}},[t("el-input",{attrs:{placeholder:"媒体服务IP",clearable:""},model:{value:e.mediaServerForm.ip,callback:function(r){e.$set(e.mediaServerForm,"ip",r)},expression:"mediaServerForm.ip"}})],1),t("el-form-item",{attrs:{label:"Http端口",prop:"portHttp"}},[t("el-input",{attrs:{placeholder:"媒体服务HTTP端口",clearable:""},model:{value:e.mediaServerForm.portHttp,callback:function(r){e.$set(e.mediaServerForm,"portHttp",r)},expression:"mediaServerForm.portHttp"}})],1),t("el-form-item",{attrs:{label:"服务密钥",prop:"secret"}},[t("el-input",{attrs:{placeholder:"媒体服务SECRET",clearable:""},model:{value:e.mediaServerForm.secret,callback:function(r){e.$set(e.mediaServerForm,"secret",r)},expression:"mediaServerForm.secret"}})],1),t("el-form-item",[t("div",{staticStyle:{float:"right","font-size":"28px"}},[t("el-button",{on:{click:e.close}},[e._v("取消")]),t("el-button",{attrs:{type:"success",loading:e.btnLoading},on:{click:e.checkServer}},[e._v("测试")]),1===e.currentStep&&1===e.serverCheck?t("el-button",{attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")]):e._e()],1)])],1):e._e(),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:12}},[2===e.currentStep||3===e.currentStep?t("el-form",{ref:"mediaServerForm1",attrs:{rules:e.rules,model:e.mediaServerForm,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"配置名称",prop:"serverId"}},[t("el-input",{attrs:{placeholder:"配置名称",clearable:""},model:{value:e.mediaServerForm.serverId,callback:function(r){e.$set(e.mediaServerForm,"serverId",r)},expression:"mediaServerForm.serverId"}})],1),t("el-form-item",{attrs:{label:"服务器IP",prop:"ip"}},[2===e.currentStep?t("el-input",{attrs:{disabled:""},model:{value:e.mediaServerForm.ip,callback:function(r){e.$set(e.mediaServerForm,"ip",r)},expression:"mediaServerForm.ip"}}):e._e(),3===e.currentStep?t("el-input",{model:{value:e.mediaServerForm.ip,callback:function(r){e.$set(e.mediaServerForm,"ip",r)},expression:"mediaServerForm.ip"}}):e._e()],1),t("el-form-item",{attrs:{label:"Http端口",prop:"portHttp"}},[2===e.currentStep?t("el-input",{attrs:{disabled:""},model:{value:e.mediaServerForm.portHttp,callback:function(r){e.$set(e.mediaServerForm,"portHttp",r)},expression:"mediaServerForm.portHttp"}}):e._e(),3===e.currentStep?t("el-input",{model:{value:e.mediaServerForm.portHttp,callback:function(r){e.$set(e.mediaServerForm,"portHttp",r)},expression:"mediaServerForm.portHttp"}}):e._e()],1),t("el-form-item",{attrs:{label:"HookUrl",prop:"hookurl"}},[t("el-input",{attrs:{placeholder:"HookUrl",clearable:""},model:{value:e.mediaServerForm.hookurl,callback:function(r){e.$set(e.mediaServerForm,"hookurl",r)},expression:"mediaServerForm.hookurl"}})],1),t("el-form-item",{attrs:{label:"Https端口",prop:"portHttps"}},[t("el-input",{attrs:{placeholder:"Https端口",clearable:""},model:{value:e.mediaServerForm.portHttps,callback:function(r){e.$set(e.mediaServerForm,"portHttps",r)},expression:"mediaServerForm.portHttps"}})],1),t("el-form-item",{attrs:{label:"Rtsp端口",prop:"portRtsp"}},[t("el-input",{attrs:{placeholder:"Rtsp端口",clearable:""},model:{value:e.mediaServerForm.portRtsp,callback:function(r){e.$set(e.mediaServerForm,"portRtsp",r)},expression:"mediaServerForm.portRtsp"}})],1),t("el-form-item",{attrs:{label:"播放协议",prop:"protocol"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.mediaServerForm.protocol,callback:function(r){e.$set(e.mediaServerForm,"protocol",r)},expression:"mediaServerForm.protocol"}},[t("el-option",{key:"http",attrs:{label:"http",value:"http"}}),t("el-option",{key:"https",attrs:{label:"https",value:"https"}}),t("el-option",{key:"ws",attrs:{label:"ws",value:"ws"}}),t("el-option",{key:"rtmp",attrs:{label:"rtmp",value:"rtmp"}}),t("el-option",{key:"rtsp",attrs:{label:"rtsp",value:"rtsp"}})],1)],1)],1):e._e()],1),t("el-col",{attrs:{span:12}},[2===e.currentStep||3===e.currentStep?t("el-form",{ref:"mediaServerForm2",attrs:{rules:e.rules,model:e.mediaServerForm,"label-width":"180px"}},[t("el-form-item",{attrs:{label:"Rtmp端口",prop:"portRtmp"}},[t("el-input",{attrs:{placeholder:"Rtmp端口",clearable:""},model:{value:e.mediaServerForm.portRtmp,callback:function(r){e.$set(e.mediaServerForm,"portRtmp",r)},expression:"mediaServerForm.portRtmp"}})],1),t("el-form-item",{attrs:{label:"流媒体密钥",prop:"secret"}},[2===e.currentStep?t("el-input",{attrs:{disabled:""},model:{value:e.mediaServerForm.secret,callback:function(r){e.$set(e.mediaServerForm,"secret",r)},expression:"mediaServerForm.secret"}}):e._e(),3===e.currentStep?t("el-input",{model:{value:e.mediaServerForm.secret,callback:function(r){e.$set(e.mediaServerForm,"secret",r)},expression:"mediaServerForm.secret"}}):e._e()],1),t("el-form-item",{attrs:{label:"自动配置"}},[t("el-switch",{model:{value:e.mediaServerForm.autoConfig,callback:function(r){e.$set(e.mediaServerForm,"autoConfig",r)},expression:"mediaServerForm.autoConfig"}})],1),t("el-form-item",{attrs:{label:"收流模式"}},[t("el-switch",{attrs:{"active-text":"多端口","inactive-text":"单端口"},on:{change:e.portRangeChange},model:{value:e.mediaServerForm.rtpEnable,callback:function(r){e.$set(e.mediaServerForm,"rtpEnable",r)},expression:"mediaServerForm.rtpEnable"}})],1),e.mediaServerForm.rtpEnable?e._e():t("el-form-item",{attrs:{label:"收流端口",prop:"rtpProxyPort"}},[t("el-input",{attrs:{clearable:""},model:{value:e.mediaServerForm.rtpProxyPort,callback:function(r){e.$set(e.mediaServerForm,"rtpProxyPort",e._n(r))},expression:"mediaServerForm.rtpProxyPort"}})],1),e.mediaServerForm.rtpEnable?t("el-form-item",{attrs:{label:"收流端口"}},[t("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"起始",clearable:"",prop:"rtpPortRange1"},on:{change:e.portRangeChange},model:{value:e.rtpPortRange1,callback:function(r){e.rtpPortRange1=r},expression:"rtpPortRange1"}}),t("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"终止",clearable:"",prop:"rtpPortRange2"},on:{change:e.portRangeChange},model:{value:e.rtpPortRange2,callback:function(r){e.rtpPortRange2=r},expression:"rtpPortRange2"}})],1):e._e(),t("el-form-item",{attrs:{label:"录像管理端口",prop:"recordPort"}},[t("el-input",{model:{value:e.mediaServerForm.recordPort,callback:function(r){e.$set(e.mediaServerForm,"recordPort",e._n(r))},expression:"mediaServerForm.recordPort"}},[e.mediaServerForm.recordPort>0?t("el-button",{staticClass:"el-icon-check",attrs:{slot:"append",type:"primary"},on:{click:e.checkRecordServer},slot:"append"}):e._e()],1),1==e.recordServerCheck?t("i",{staticClass:"el-icon-success",staticStyle:{color:"#3caf36",position:"absolute",top:"14px"}}):e._e(),2==e.recordServerCheck?t("i",{staticClass:"el-icon-loading",staticStyle:{color:"#3caf36",position:"absolute",top:"14px"}}):e._e(),-1===e.recordServerCheck?t("i",{staticClass:"el-icon-error",staticStyle:{color:"#c80000",position:"absolute",top:"14px"}}):e._e()],1),t("el-form-item",[t("div",{staticStyle:{float:"right"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]),t("el-button",{on:{click:e.close}},[e._v("关闭")])],1)])],1):e._e()],1)],1)],1)]),t("user-list",{ref:"userList",on:{userEvent:function(r){return e.getUserData(r)}}})],1)},a=[],i=(t("ac1f"),t("00b4"),t("d9e2"),t("5a6f")),l=t("a64d"),n={name:"MediaServerEdit",components:{userList:l["default"]},props:{},computed:{},created:function(){this.setDialogWidth()},data:function(){var e=function(e,r,t){var o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return o.test(r)?(t(),!0):t(new Error("请输入有效的IP地址"))},r=function(e,r,t){var o=/^(([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5]))$/;return o.test(r)?(t(),!0):t(new Error("请输入有效的端口号"))};return{tempTenantId:"",tempTenantName:"",btnLoading:!1,dialogWidth:"",defaultWidth:1e3,listChangeCallback:null,showDialog:!1,isLoging:!1,dialogLoading:!1,currentStep:1,platformList:[],serverCheck:0,recordServerCheck:0,mediaServerForm:{serverId:"",ip:"",productId:"",productName:"",tenantId:"",tenantName:"",autoConfig:!0,hookurl:"",secret:"",portHttp:"",portHttps:"",recordPort:"",portRtmp:"",portRtsp:"",rtpEnable:!0,rtpPortRange:"",rtpProxyPort:""},rtpPortRange1:3e4,rtpPortRange2:30100,rules:{ip:[{required:!0,validator:e,message:"请输入有效的IP地址",trigger:"blur"}],portHttp:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],portHttps:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],recordPort:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],portRtmp:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],portRtsp:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],rtpPortRange1:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],rtpPortRange2:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],rtpProxyPort:[{required:!0,validator:r,message:"请输入有效的端口号",trigger:"blur"}],secret:[{required:!0,message:"请输入secret",trigger:"blur"}]}}},methods:{setDialogWidth:function(){var e=document.body.clientWidth;e<this.defaultWidth?this.dialogWidth="100%":this.dialogWidth=this.defaultWidth+"px"},openDialog:function(e,r){if(this.showDialog=!0,this.listChangeCallback=r,null!=e&&(e.autoConfig=1===e.autoConfig,e.rtpEnable=1===e.rtpEnable,this.mediaServerForm=e,this.currentStep=3,e.rtpPortRange)){var t=this.mediaServerForm.rtpPortRange.split(",");t.length>0&&(this.rtpPortRange1=t[0],this.rtpPortRange2=t[1])}},checkServer:function(){var e=this;this.$refs.mediaServerForm.validate((function(r){if(r){e.btnLoading=!0,e.serverCheck=0;var t={ip:e.mediaServerForm.ip,port:e.mediaServerForm.portHttp,secret:e.mediaServerForm.secret};Object(i["b"])(t).then((function(r){if(e.btnLoading=!1,null!=r.data){var t=e.mediaServerForm.portHttp;e.mediaServerForm=r.data,e.mediaServerForm.portHttp=t,e.mediaServerForm.portHttps=8443,e.mediaServerForm.recordPort=18081,e.mediaServerForm.autoConfig=!0,e.mediaServerForm.rtpEnable=!0,e.mediaServerForm.protocol="http",e.mediaServerForm.enabled=1,e.mediaServerForm.tenantId=e.tempTenantId,e.mediaServerForm.tenantName=e.tempTenantName,e.mediaServerForm.serverId="fastbee",e.mediaServerForm.hookurl="java:8080",e.mediaServerForm.portRtmp="1935",e.mediaServerForm.portRtsp="554",e.mediaServerForm.rtpProxyPort="",e.rtpPortRange1=3e4,e.rtpPortRange2=30100,e.serverCheck=1,e.$modal.alertSuccess("配置地址连接成功")}else e.serverCheck=-1,e.$modal.alertError("配置地址无法连接")})).catch((function(r){e.serverCheck=-1,e.$message({showClose:!0,message:r,type:"error"})}))}}))},next:function(){this.currentStep=2,this.defaultWidth=900,this.setDialogWidth()},checkRecordServer:function(){var e=this;if(e.recordServerCheck=2,e.mediaServerForm.recordPort<=0||e.mediaServerForm.recordPort>65535)return e.recordServerCheck=-1,void e.$message({showClose:!0,message:"端口号应该在-65535之间",type:"error"})},onSubmit:function(){var e=this;this.dialogLoading=!0,this.mediaServerForm.rtpEnable=this.mediaServerForm.rtpEnable?1:0,this.mediaServerForm.autoConfig=this.mediaServerForm.autoConfig?1:0,null!=this.mediaServerForm.id?Object(i["f"])(this.mediaServerForm).then((function(r){e.$modal.msgSuccess("修改成功"),e.showDialog=!1})):(this.portRangeChange(),Object(i["a"])(this.mediaServerForm).then((function(r){e.$modal.msgSuccess("新增成功"),e.showDialog=!1}))),this.$parent.getServerList()},close:function(){this.showDialog=!1,this.dialogLoading=!1,this.mediaServerForm={serverId:"",ip:"",autoConfig:!0,hookurl:"",secret:"",portHttp:"",portHttps:"",recordPort:"",portRtmp:"",portRtsp:"",rtpEnable:!0,rtpPortRange:"",rtpProxyPort:""},this.rtpPortRange1=3e4,this.rtpPortRange2=30100,this.listChangeCallback=null,this.currentStep=1},portRangeChange:function(){this.mediaServerForm.rtpEnable&&(this.mediaServerForm.rtpPortRange=this.rtpPortRange1+","+this.rtpPortRange2,console.log(this.mediaServerForm.rtpPortRange))},selectUser:function(){this.$refs.userList.open=!0,this.$refs.userList.getList()},getUserData:function(e){this.tempTenantId=e.userId,this.tempTenantName=e.userName,this.mediaServerForm.tenantId=e.userId,this.mediaServerForm.tenantName=e.userName}}},s=n,m=t("2877"),p=Object(m["a"])(s,o,a,!1,null,null,null);r["default"]=p.exports},a64d:function(e,r,t){"use strict";t.r(r);var o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("el-dialog",{attrs:{title:"选择用户",visible:e.open,width:"800px"},on:{"update:visible":function(r){e.open=r}}},[t("div",{staticStyle:{"margin-top":"-50px"}},[t("el-divider")],1),t("el-form",{ref:"queryForm",attrs:{model:e.queryParams,rules:e.rules,inline:!0,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[t("el-input",{staticStyle:{width:"240px"},attrs:{type:"text",placeholder:"请输入用户手机号码",minlength:"10",clearable:"",size:"small","show-word-limit":""},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.handleQuery(r)}},model:{value:e.queryParams.phonenumber,callback:function(r){e.$set(e.queryParams,"phonenumber",r)},expression:"queryParams.phonenumber"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,"highlight-current-row":"",size:"mini",border:""},on:{"current-change":e.handleCurrentChange}},[t("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("input",{attrs:{type:"radio",name:"user"},domProps:{checked:e.row.isSelect}})]}}])}),t("el-table-column",{key:"userId",attrs:{label:"用户编号",align:"center",prop:"userId",width:"120"}}),t("el-table-column",{key:"userName",attrs:{label:"用户名称",align:"center",prop:"userName"}}),t("el-table-column",{key:"nickName",attrs:{label:"用户昵称",align:"center",prop:"nickName"}}),t("el-table-column",{key:"phonenumber",attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"120"}}),t("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("span",[e._v(e._s(e.parseTime(r.row.createTime)))])]}}])})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.confirmSelectUser}},[e._v("确定")]),t("el-button",{on:{click:e.closeSelectUser}},[e._v("关 闭")])],1)],1)},a=[],i=t("bb86"),l={name:"user-list",props:{device:{type:Array,default:null}},watch:{device:function(e,r){this.deviceInfo=e}},data:function(){return{loading:!1,ids:[],title:"",userList:[],user:{},deviceInfo:{},open:!1,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:0,deptId:void 0},rules:{phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{min:11,max:11,message:"手机号码长度为11位",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(i["c"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(r){e.userList=r.rows,e.total=r.total,e.loading=!1}))},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(r){r&&(e.queryParams.pageNum=1,e.getList())}))},resetQuery:function(){this.$refs["queryForm"].resetFields(),this.userList=[]},setRadioSelected:function(e){for(var r=0;r<this.userList.length;r++)this.userList[r].userId==e?(this.userList[r].isSelect=!0,this.user=this.userList[r]):this.userList[r].isSelect=!1},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.userId),this.user=e)},confirmSelectUser:function(){this.$emit("userEvent",this.user),this.open=!1},closeSelectUser:function(){this.open=!1,this.resetQuery()}}},n=l,s=t("2877"),m=Object(s["a"])(n,o,a,!1,null,null,null);r["default"]=m.exports},bb86:function(e,r,t){"use strict";t.d(r,"d",(function(){return a})),t.d(r,"c",(function(){return i})),t.d(r,"b",(function(){return l})),t.d(r,"a",(function(){return n})),t.d(r,"e",(function(){return s}));var o=t("b775");t("bc3a"),t("5c96"),t("21a6"),t("5f87"),t("c38a");function a(e){return Object(o["a"])({url:"/iot/tool/register",headers:{isToken:!1},method:"post",data:e})}function i(e){return Object(o["a"])({url:"/iot/tool/userList",method:"get",params:e})}function l(e){return Object(o["a"])({url:"/iot/tool/getTopics",method:"get",params:e})}function n(e){return Object(o["a"])({url:"/iot/tool/decode",method:"get",params:e})}function s(e){return Object(o["a"])({url:"/iot/tool/simulate",method:"get",params:e})}}}]);
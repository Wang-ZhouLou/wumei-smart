(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51a5b6ce","chunk-32cc1227"],{"0913":function(t,e,a){"use strict";a("1fea")},"1fea":function(t,e,a){},"3abb":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticStyle:{margin:"6px","padding-bottom":"10px"}},[a("el-tabs",{staticStyle:{padding:"10px",height:"750px"},attrs:{"tab-position":"left"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"play"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("svg-icon",{staticStyle:{"font-size":"32px"},attrs:{"icon-class":"live1"}})],1),a("div",{staticClass:"components-container"},[a("el-row",[a("el-col",{attrs:{span:1}},[a("svg-icon",{staticStyle:{width:"30px",height:"30px"},attrs:{"icon-class":"arrow-left"},on:{click:function(e){return t.goBack()}}})],1),a("span",{staticStyle:{"font-size":"20px"}},[t._v("设 备 直 播")])],1)],1),a("div",{staticStyle:{margin:"0 20px",width:"900px"}},[a("el-divider")],1),a("div",{staticStyle:{width:"920px"}},[a("player",{ref:"player",staticClass:"components-container",attrs:{playerinfo:t.playinfo}}),a("div",{staticStyle:{margin:"0 20px",width:"900px"}},[a("el-divider")],1),a("div",{staticStyle:{display:"flex","justify-content":"space-around"}},[a("el-row",[a("span",{staticStyle:{"font-size":"16px","margin-right":"10px"}},[t._v("开启直播录像:")]),a("el-switch",{staticStyle:{"border-radius":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#c4c6c9"},on:{change:t.startPlayRecordk},model:{value:t.playrecord,callback:function(e){t.playrecord=e},expression:"playrecord"}})],1)],1)],1)]),a("el-tab-pane",{attrs:{name:"playback"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("svg-icon",{staticStyle:{"font-size":"35px",margin:"10px 0px 0 50px"},attrs:{"icon-class":"videotape"}})],1),a("div",{staticClass:"components-container"},[a("el-row",{staticStyle:{"margin-right":"30px"}},[a("el-col",{attrs:{span:1}},[a("svg-icon",{staticStyle:{"font-size":"30px"},attrs:{"icon-class":"arrow-left"},on:{click:function(e){return t.goBack()}}})],1),a("span",{staticStyle:{overflow:"auto","font-size":"20px","text-align":"center"}},[t._v("设 备 录 像")])],1)],1),a("div",{staticStyle:{margin:"0 20px",width:"900px"}},[a("el-divider")],1),a("div",{staticStyle:{display:"block",width:"940px"}},[a("player",{ref:"player",staticClass:"components-container",attrs:{playerinfo:t.playinfo}}),a("div",{staticStyle:{margin:"0 20px",width:"900px"}},[a("el-divider")],1),a("div",{staticStyle:{display:"flex","justify-content":"space-around"}},[a("el-row",[a("span",{staticStyle:{overflow:"auto","font-size":"15px"}},[t._v("选择录像日期：")]),a("el-date-picker",{staticStyle:{width:"200px"},attrs:{type:"date",size:"small","value-format":"yyyy-MM-dd",clearable:"",placeholder:"选择日期"},on:{change:t.loadDevRecord},model:{value:t.queryDate,callback:function(e){t.queryDate=e},expression:"queryDate"}}),a("span",{staticStyle:{"margin-left":"20px",overflow:"auto","font-size":"15px"}},[t._v("转录的时间段：")]),a("el-button-group",[a("el-time-picker",{staticStyle:{width:"250px"},attrs:{size:"small","is-range":"",align:"left","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},on:{change:t.timePickerChange},model:{value:t.timeRange,callback:function(e){t.timeRange=e},expression:"timeRange"}})],1),a("el-button-group",{staticStyle:{margin:"0 20px"}},[a("el-button",{attrs:{size:"mini",type:"primary",title:"下载选定录像"},on:{click:function(e){return t.downloadRecord()}}},[a("i",{staticClass:"el-icon-download"}),t._v("下载 ")])],1)],1)],1)],1)]),a("el-tab-pane",{attrs:{disabled:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",{staticStyle:{"margin-top":"200px"}})])])],1)],1)},n=[],s=(a("b0c0"),a("d3b7"),a("97d6")),r=a("e2de"),o=a("6827"),c={name:"DevicePlayer",components:{player:s["default"]},data:function(){return{activeName:"play",deviceId:"",channelId:"",streamId:"",ssrc:"",playurl:"",queryDate:"",vodData:{},hisData:[],playinfo:{},playrecord:!1,playrecording:!1,playbackinfo:{},timeRange:null,startTime:null,endTime:null}},beforeDestroy:function(){},activated:function(){var t=this.$route.query.activeName;null!=t&&""!==t&&(this.activeName=t)},created:function(){if(this.$route.params){this.deviceId=this.$route.params.deviceId,this.channelId=this.$route.params.channelId;var t=this.$route.params.activeName;null!=t&&""!==t&&(this.activeName=t,"play"===this.activeName&&this.sendDevicePush()),this.playinfo={playtype:"play",deviceId:this.deviceId,channelId:this.channelId},this.playbackinfo={playtype:"playback",deviceId:this.deviceId,channelId:this.channelId}}},destroyed:function(){this.closeStream(),this.$refs.player.destroy(),this.$refs.playbacker.destroy()},methods:{startPlayRecordk:function(){var t=this;this.$refs.player.destroy(),this.playrecord?(this.closeStream(),Object(o["f"])(this.deviceId,this.channelId).then((function(e){console.log("开始录像："+t.deviceId+" : "+t.channelId),t.playrecording=!0;var a=e.data;t.streamId=a.streamId,t.playurl=a.playurl,t.$refs.player.isInit||t.$refs.player.init(),t.$refs.player.play(a.playurl)}))):(this.playrecording=!1,this.closeStream(),this.sendDevicePush())},handleClick:function(t,e){this.closeStream(),"play"===t.name?(this.$refs.playbacker.destroy(),this.sendDevicePush()):(this.$refs.player.destroy(),this.$refs.playbacker.registercallback("playbackSeek",this.seekPlay))},sendDevicePush:function(){var t=this;console.log("通知设备推流1："+this.deviceId+" : "+this.channelId),Object(r["k"])(this.deviceId,this.channelId).then((function(e){console.log("开始播放："+t.deviceId+" : "+t.channelId);var a=e.data;t.streamId=a.streamId,t.playurl=a.playurl,t.$refs.player.isInit||t.$refs.player.init(),t.$refs.player.play(a.playurl)}))},initUrl:function(t){t?(this.streamId=t.ssrc,this.ssrc=t.ssrc,this.playurl=t.playurl):(this.streamId="",this.ssrc="",this.playurl="")},loadDevRecord:function(){var t=this;if(this.deviceId&&this.channelId){var e=this.queryDate?new Date(this.queryDate).getTime():new Date((new Date).toLocaleDateString()).getTime(),a=e/1e3,i=Math.floor((e+864e5-1)/1e3),n={start:a,end:i};this.vodData={start:a,end:i,base:a},this.setTime(this.queryDate+" 00:00:00",this.queryDate+" 23:59:59"),Object(o["a"])(this.deviceId,this.channelId,n).then((function(e){if(t.hisData=e.data.recordItems,e.data.recordItems){var n=t.hisData.length;n>0?(t.hisData[0].start<a?(t.hisData[0].start=a,t.vodData.start=a):t.vodData.start=t.hisData[0].start,t.hisData[0].end<i&&(t.vodData.end=t.hisData[0].end),t.playback()):t.$message({type:"warning",message:"请确认设备是否支持录像，或者设备SD卡是否正确插入！"})}else t.$message({type:"warning",message:"请确认设备是否支持录像，或者设备SD卡是否正确插入！"})}))}},playback:function(){var t=this;if(this.ssrc)Object(r["b"])(this.deviceId,this.channelId,this.ssrc).then((function(e){var a={start:t.vodData.start,end:t.vodData.end};Object(r["f"])(t.deviceId,t.channelId,a).then((function(e){t.playing=!0,t.initUrl(e.data)})).finally((function(){t.triggerPlay(t.hisData)}))}));else{var e={start:this.vodData.start,end:this.vodData.end};Object(r["f"])(this.deviceId,this.channelId,e).then((function(e){t.playing=!0,t.initUrl(e.data)})).finally((function(){t.triggerPlay(t.hisData)}))}},triggerPlay:function(t){this.$refs.playbacker.playback(this.playurl,t)},seekPlay:function(t){var e=this.vodData.base+3600*t.hour+60*t.min+t.second,a=e-this.vodData.start;if(this.ssrc){var i={seek:a},n=this;Object(r["i"])(this.deviceId,this.channelId,this.streamId,i).then((function(t){n.$refs.playbacker.setPlaybackStartTime(e)}))}},closeStream:function(){var t=this;"play"===this.activeName&&!0===this.playrecording||this.streamId&&Object(r["b"])(this.deviceId,this.streamId).then((function(e){t.streamId="",t.ssrc="",t.playurl=""}))},timePickerChange:function(t){this.setTime(t[0],t[1])},setTime:function(t,e){this.startTime=t,this.endTime=e,this.timeRange=[t,e]},downloadRecord:function(){var t=this,e=new Date(this.startTime).getTime()/1e3,a=new Date(this.endTime).getTime()/1e3,i={startTime:e,endTime:a,speed:"4"};Object(o["e"])(this.deviceId,this.channelId,i).then((function(e){console.log("开始下载录像："+t.deviceId+" : "+t.channelId)}))},goBack:function(){var t={path:"/iot/device",query:{t:Date.now(),pageNum:this.$route.query.pageNum}};this.$tab.closeOpenPage(t),this.reset()}}},l=c,d=(a("d937"),a("2877")),u=Object(d["a"])(l,i,n,!1,null,"3857e7da",null);e["default"]=u.exports},6827:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return o})),a.d(e,"f",(function(){return c})),a.d(e,"e",(function(){return l}));var i=a("b775");function n(t,e,a){return Object(i["a"])({url:"/sip/record/devquery/"+t+"/"+e,method:"get",params:a})}function s(t){return Object(i["a"])({url:"/sip/record/serverRecord/list",method:"get",params:t})}function r(t){return Object(i["a"])({url:"/sip/record/serverRecord/date/list",method:"get",params:t})}function o(t){return Object(i["a"])({url:"/sip/record/serverRecord/file/list",method:"get",params:t})}function c(t,e){return Object(i["a"])({url:"/sip/record/play/"+t+"/"+e,method:"get"})}function l(t,e,a){return Object(i["a"])({url:"/sip/record/download/"+t+"/"+e,method:"get",params:a})}},"97d6":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"root"},[a("div",{staticClass:"container-shell"},[a("div",{ref:"container",attrs:{id:"container"}})])])},n=[],s=a("c7eb"),r=a("1da1"),o=(a("a9e3"),a("ac1f"),a("00b4"),a("f5a7")),c={},l={name:"player",props:{playerinfo:{type:Object,default:null}},mounted:function(){console.log(this._uid)},watch:{playerinfo:function(t,e){console.log("playerinfo 发生变化"),this.playinfo=t,this.playinfo&&""!==this.playinfo.playtype&&(this.playtype=this.playinfo.playtype)}},jessibuca:null,data:function(){return{isPlaybackPause:!1,useWebGPU:!1,isInit:!1,playinfo:{},playtype:"play",operateBtns:{}}},beforeDestroy:function(){},created:function(){this.playinfo=this.playerinfo,this.playinfo&&""!==this.playinfo.playtype&&(this.playtype=this.playinfo.playtype),this.init()},methods:{init:function(){var t=this,e="gpu"in navigator;e?(console.log("支持webGPU"),this.useWebGPU=!0):(console.log("暂不支持webGPU，降级到webgl渲染"),this.useWebGPU=!1);var a=this.isMobile()||this.isPad();a&&window.VConsole&&new window.VConsole,this.$nextTick((function(){t.initplayer()}))},initplayer:function(){this.isPlaybackPause=!1,this.initconf(),c[this._uid]=new window.JessibucaPro({container:this.$refs.container,decoder:"/js/jessibuca-pro/decoder-pro.js",videoBuffer:Number(.2),isResize:!1,useWCS:!1,useMSE:!1,useSIMD:!0,wcsUseVideoRender:!1,loadingText:"加载中",debug:!1,showBandwidth:!0,showPlaybackOperate:!0,operateBtns:this.operateBtns,forceNoOffscreen:!0,isNotMute:!1,showPerformance:!1,playbackForwardMaxRateDecodeIFrame:4,useWebGPU:this.useWebGPU});var t=c[this._uid];this.initcallback(t),this.isInit=!0},initconf:function(){"play"===this.playtype?this.operateBtns={fullscreen:!0,zoom:!0,ptz:!0,play:!0}:this.operateBtns={fullscreen:!0,zoom:!0,play:!0,ptz:!1}},initcallback:function(t){var e=this;t.on("error",(function(t){console.log("error"),console.log(t),e.destroy()})),t.on("pause",(function(t){console.log("pause success!"),console.log(t)})),t.on("stats",(function(t){console.log("stats is",t)})),t.on("timeout",(function(){console.log("timeout")})),t.on("playbackPreRateChange",(function(e){t.forward(e)}));var a=0,i=0;t.on("timeUpdate",(function(t){i=parseInt(t/6e4),a!==i&&a++})),t.on(JessibucaPro.EVENTS.ptz,(function(t){console.log("ptz arrow",t),e.handlePtz(t)}))},registercallback:function(t,e){c[this._uid]&&c[this._uid].on(t,e)},isMobile:function(){return/iphone|ipad|android.*mobile|windows.*phone|blackberry.*mobile/i.test(window.navigator.userAgent.toLowerCase())},isPad:function(){return/ipad|android(?!.*mobile)|tablet|kindle|silk/i.test(window.navigator.userAgent.toLowerCase())},play:function(t){c[this._uid]&&c[this._uid].play(t)},pause:function(){c[this._uid]&&c[this._uid].pause()},replay:function(t){var e=this;c[this._uid]?c[this._uid].destroy().then((function(){e.initplayer(),e.play(t)})):(this.initplayer(),this.play(t))},handlePtz:function(t){var e=0,a=0;"left"===t?e=2:"right"===t?e=1:"up"===t?a=1:"down"===t&&(a=2);var i={leftRight:e,upDown:a,moveSpeed:125};this.playinfo&&""!==this.playinfo.playtype&&Object(o["c"])(this.playinfo.deviceId,this.playinfo.channelId,i).then(function(){var t=Object(r["a"])(Object(s["a"])().mark((function t(e){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},playback:function(t,e){c[this._uid]&&(c[this._uid].playback(t,{playList:e,fps:25,showControl:!0,showRateBtn:!0,isUseFpsRender:!0,isCacheBeforeDecodeForFpsRender:!1,supportWheel:!0,rateConfig:[{label:"正常",value:1},{label:"2倍",value:2},{label:"4倍",value:4},{label:"8倍",value:8}]}),this.isPlaybackPause=!1)},playbackPause:function(){c[this._uid]&&(c[this._uid].playbackPause(),this.isPlaybackPause=!0)},replayback:function(t,e){var a=this;c[this._uid]?c[this._uid].destroy().then((function(){a.initplayer(),a.playback(t,e)})):(this.initplayer(),this.playback(t,e))},destroy:function(){var t=this;c[this._uid]&&c[this._uid].destroy().then((function(){t.initplayer()}))},close:function(){c[this._uid]&&c[this._uid].close()}}},d=l,u=(a("0913"),a("2877")),p=Object(u["a"])(d,i,n,!1,null,"f44903e0",null);e["default"]=p.exports},d937:function(t,e,a){"use strict";a("dd74")},dd74:function(t,e,a){},e2de:function(t,e,a){"use strict";a.d(e,"e",(function(){return n})),a.d(e,"d",(function(){return s})),a.d(e,"a",(function(){return r})),a.d(e,"c",(function(){return o})),a.d(e,"k",(function(){return c})),a.d(e,"f",(function(){return l})),a.d(e,"b",(function(){return d})),a.d(e,"g",(function(){return u})),a.d(e,"h",(function(){return p})),a.d(e,"i",(function(){return h})),a.d(e,"j",(function(){return f}));var i=a("b775");function n(t){return Object(i["a"])({url:"/sip/channel/list",method:"get",params:t})}function s(t){return Object(i["a"])({url:"/sip/channel/"+t,method:"get"})}function r(t,e){return Object(i["a"])({url:"/sip/channel/"+t,method:"post",data:e})}function o(t){return Object(i["a"])({url:"/sip/channel/"+t,method:"delete"})}function c(t,e){return Object(i["a"])({url:"/sip/player/play/"+t+"/"+e,method:"get"})}function l(t,e,a){return Object(i["a"])({url:"/sip/player/playback/"+t+"/"+e,method:"get",params:a})}function d(t,e){return Object(i["a"])({url:"/sip/player/closeStream/"+t+"/"+e,method:"get"})}function u(t,e,a){return Object(i["a"])({url:"/sip/player/playbackPause/"+t+"/"+e+"/"+a,method:"get"})}function p(t,e,a){return Object(i["a"])({url:"/sip/player/playbackReplay/"+t+"/"+e+"/"+a,method:"get"})}function h(t,e,a,n){return Object(i["a"])({url:"/sip/player/playbackSeek/"+t+"/"+e+"/"+a,method:"get",params:n})}function f(t,e,a,n){return Object(i["a"])({url:"/sip/player/playbackSpeed/"+t+"/"+e+"/"+a,method:"get",params:n})}},f5a7:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"a",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return o}));var i=a("b775");function n(t){return Object(i["a"])({url:"/sip/device/listchannel/"+t,method:"get"})}function s(t){return Object(i["a"])({url:"/sip/device/sipid/"+t,method:"delete"})}function r(t,e,a){return Object(i["a"])({url:"/sip/ptz/direction/"+t+"/"+e,method:"post",data:a})}function o(t,e,a){return Object(i["a"])({url:"/sip/ptz/scale/"+t+"/"+e,method:"post",data:a})}}}]);